<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WebAR: 3D –†–æ–±–æ—Ç –Ω–∞ –º–∞—Ä–∫–µ—Ä–µ</title>
    <link rel="stylesheet" href="css/style.css">
    
    <!-- –¢–û–õ–¨–ö–û A-Frame (Three.js —É–∂–µ –≤–Ω—É—Ç—Ä–∏) -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- AR.js –¥–ª—è A-Frame -->
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.0/aframe/build/aframe-ar.min.js"></script>    
    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç -->
    <script src="js/app.js" defer></script>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
</head>
<body>
    <div id="app">
        <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ -->
        <div id="status-panel" class="panel">
            <p id="status-message">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ AR...</p>
            <div id="permission-hint" class="hidden">
                <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∏—Ç –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–π –∫–∞–º–µ—Ä–µ. –ù–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å".</p>
                <button id="start-button">–ù–∞—á–∞—Ç—å AR-–æ–ø—ã—Ç</button>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è AR-—Å—Ü–µ–Ω—ã -->
        <div id="ar-container" class="hidden">
            <!-- –ü–†–û–°–¢–ê–Ø –°–¶–ï–ù–ê -->
            <a-scene 
                embedded 
                vr-mode-ui="enabled: false"
                arjs="sourceType: webcam; debugUIEnabled: false;">
                
                <!-- –ê—Å—Å–µ—Ç—ã –ü–ï–†–ï–î –º–∞—Ä–∫–µ—Ä–æ–º -->
                <a-assets>
                    <a-asset-item id="robot" src="assets/models/robot.glb"></a-asset-item>
                </a-assets>
                
                <!-- –ú–∞—Ä–∫–µ—Ä Hiro (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π, –Ω–µ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª) -->
                <a-marker 
                    id="main-marker"
                    preset="hiro"
                    emitevents="true"
                    raycaster-listener>
                    
                    <!-- 3D –º–æ–¥–µ–ª—å –°–†–ê–ó–£ –∑–¥–µ—Å—å -->
                    <a-entity 
                        id="robot-model"
                        gltf-model="#robot"
                        position="0 0.5 0"
                        scale="0.5 0.5 0.5"
                        rotation="0 0 0"
                        animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear">
                    </a-entity>
                    
                </a-marker>
                
                <!-- –ö–∞–º–µ—Ä–∞ -->
                <a-entity camera></a-entity>
                
            </a-scene>

            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div id="controls-panel" class="panel hidden">
                <div class="controls-grid">
                    <button class="control-btn" data-action="rotate-left">‚Ü∂</button>
                    <button class="control-btn" data-action="scale-up">+</button>
                    <button class="control-btn" data-action="scale-down">‚àí</button>
                    <button class="control-btn" data-action="rotate-right">‚Ü∑</button>
                    <button class="control-btn wide" data-action="reset">–°–±—Ä–æ—Å</button>
                </div>
            </div>

            <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
            <div id="instruction" class="panel">
                <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä Hiro</p>
                <div class="marker-preview">
                    <img src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" alt="–ú–∞—Ä–∫–µ—Ä Hiro">
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ -->
        <div id="error-panel" class="panel hidden">
            <h3>‚ö†Ô∏è –û—à–∏–±–∫–∞</h3>
            <p id="error-message"></p>
            <button id="retry-button">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>

    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
    <script>
        document.getElementById('start-button').addEventListener('click', function() {
            document.getElementById('permission-hint').classList.add('hidden');
            document.getElementById('status-message').textContent = "–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...";
            
            setTimeout(() => {
                document.getElementById('ar-container').classList.remove('hidden');
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–∞–º–µ—Ä—É –ø—Ä–∏ –∫–ª–∏–∫–µ (–¥–ª—è iOS)
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({ video: true })
                        .then(() => console.log("–ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞"))
                        .catch(e => console.error("–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:", e));
                }
            }, 500);
        });
    </script>
</body>
</html>